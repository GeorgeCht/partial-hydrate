{"version":3,"file":"index.modern.mjs","sources":["../src/PartialHydrate.tsx"],"sourcesContent":["import * as React from 'react'\n\n/**\n * Requires at least one property of the given type T.\n *\n * @template T - The type to require properties from.\n * @template Keys - The keys of the type T to enforce presence.\n */\nexport type RequireAtLeastOne<T, Keys extends keyof T = keyof T> = Pick<T, Exclude<keyof T, Keys>> &\n  {\n    [K in Keys]-?: Required<Pick<T, K>> & Partial<Pick<T, Exclude<Keys, K>>>\n  }[Keys]\n\n/**\n * Function type for checking if a value is defined.\n *\n * @template T - The type of the value to check.\n * @param {T | undefined} v - The value to check for definedness.\n * @returns {boolean} - True if the value is defined, false otherwise.\n */\nexport interface FnIsDefined {\n  <T>(v: T | undefined): boolean\n}\n\n/**\n * Type for partial hydration props in React components.\n */\nexport type PartialHydrateProps = {\n  minWidth?: number\n  maxWidth?: number\n  when?: () => boolean\n  children: React.ReactNode\n}\n\nfunction useIsFirstRender(): boolean {\n  const isFirst = React.useRef(true)\n  return !!isFirst.current && ((isFirst.current = false), true)\n}\n\nconst isDefined: FnIsDefined = (v) => typeof v !== 'undefined' && v !== null\n\nexport const PartialHydrate: React.FC<\n  RequireAtLeastOne<PartialHydrateProps, 'minWidth' | 'maxWidth' | 'when'>\n> = ({ children, minWidth, maxWidth, when }) => {\n  const id = 'partial:' + React.useId()\n  const isClient = isDefined(window)\n  const isFirstRender = useIsFirstRender()\n  const innerWidth = window.innerWidth\n\n  const removeChildren = (id: string) => {\n    if (isClient && isFirstRender) {\n      const el = document.getElementById(id)\n      el && (el.innerHTML = '')\n    }\n    return !0\n  }\n\n  const render = isDefined(when)\n    ? (isClient ? when!() : true) && removeChildren(id)\n    : isDefined(minWidth) && isDefined(maxWidth)\n      ? (isClient ? innerWidth <= minWidth! && innerWidth >= maxWidth! : true) && removeChildren(id)\n      : isDefined(minWidth)\n        ? (isClient ? innerWidth <= minWidth! : true) && removeChildren(id)\n        : (isClient ? innerWidth >= maxWidth! : true) && removeChildren(id)\n\n  return (\n    <div id={id} style={{ display: render ? 'contents' : 'none' }}>\n      {render && children}\n    </div>\n  )\n}\n"],"names":["isDefined","v","PartialHydrate","children","minWidth","maxWidth","when","id","React","useId","isClient","window","isFirstRender","isFirst","useRef","current","useIsFirstRender","innerWidth","removeChildren","el","document","getElementById","innerHTML","render","_jsx","style","display"],"mappings":"gEAuCA,MAAMA,EAA0BC,GAAM,MAAOA,EAEhCC,EAETA,EAAGC,WAAUC,WAAUC,WAAUC,WACnC,MAAMC,EAAK,WAAaC,EAAMC,QACxBC,EAAWV,EAAUW,QACrBC,EAZR,WACE,MAAMC,EAAUL,EAAMM,QAAO,GAC7B,QAASD,EAAQE,UAAaF,EAAQE,SAAU,GAAQ,EAC1D,CASwBC,GAChBC,EAAaN,OAAOM,WAEpBC,EAAkBX,IACtB,GAAIG,GAAYE,EAAe,CAC7B,MAAMO,EAAKC,SAASC,eAAed,GACnCY,IAAOA,EAAGG,UAAY,GACxB,CACA,OAAO,CAAC,EAGJC,EAASvB,EAAUM,KACpBI,GAAWJ,MAAmBY,EAAeX,GAC9CP,EAAUI,IAAaJ,EAAUK,KAC9BK,GAAWO,GAAcb,GAAaa,GAAcZ,IAAqBa,EAAeX,GACzFP,EAAUI,KACPM,GAAWO,GAAcb,IAAqBc,EAAeX,KAC7DG,GAAWO,GAAcZ,IAAqBa,EAAeX,GAEtE,OACEiB,EAAK,MAAA,CAAAjB,GAAIA,EAAIkB,MAAO,CAAEC,QAASH,EAAS,WAAa,QAClDpB,SAAAoB,GAAUpB,GACP"}